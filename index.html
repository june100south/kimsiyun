<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸‰ì‹ ë§¤ë‹ˆì € - ìŠ¤ë§ˆíŠ¸ ê¸‰ì‹ ì‹œìŠ¤í…œ</title>

    <!-- Firebase SDKs ë° ëª¨ë“  JavaScript ë¡œì§ì„ í•˜ë‚˜ì˜ ëª¨ë“ˆ ìŠ¤í¬ë¦½íŠ¸ì— í†µí•© -->
    <script type="module">
        // Firebase ì•± ë° Firestore ê´€ë ¨ ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"; // signInWithCustomToken ì œê±°
        import { getFirestore, collection, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, query, where, getDocs, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Canvas í™˜ê²½ì—ì„œ ì œê³µë˜ëŠ” ì „ì—­ ë³€ìˆ˜ë“¤ (initialAuthTokenì€ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = {
            // ì‚¬ìš©ìë‹˜ì´ ì œê³µí•´ì£¼ì‹  API í‚¤ë¡œ ì„¤ì •
            apiKey: "AIzaSyDHsuHUmGXe-qLSzVBR6Npy8SmMQ8bJB0o",
            authDomain: "swai2-e63e9.firebaseapp.com",
            projectId: "swai2-e63e9",
            storageBucket: "swai2-e63e9.firebasestorage.app",
            messagingSenderId: "137618516147",
            appId: "1:137618516147:web:bff3d64b0a63052c3da8c6",
            measurementId: "G-SJ263PTXNZ" // ì• ë„ë¦¬í‹±ìŠ¤ ì‚¬ìš© ì•ˆí•˜ë©´ ì´ ì¤„ë„ ì‚­ì œ ê°€ëŠ¥
        };
        // const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; // ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

        // Firebase ë° Firestore ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ (ëª¨ë“ˆ ìŠ¤ì½”í”„ ìµœìƒë‹¨ì— ì„ ì–¸)
        let app;
        let db;
        let auth;
        let currentUserId = null; // í˜„ì¬ ì‚¬ìš©ì ID (ì¸ì¦ í›„ ì„¤ì •ë¨)
        let ratingsCollection;
        let exclusionsCollection;

        // --- Firebase ë° Firestore ì´ˆê¸°í™” í•¨ìˆ˜ ---
        async function initializeFirebaseAndFirestore() {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // ì‚¬ìš©ì ì¸ì¦: ìµëª…ìœ¼ë¡œë§Œ ë¡œê·¸ì¸ ì‹œë„ (custom-token-mismatch ì˜¤ë¥˜ ë°©ì§€)
                await signInAnonymously(auth);

                // ì¸ì¦ ìƒíƒœ ë³€í™” ê°ì§€ ë° ëª¨ë“  ì•± ë¡œì§ ì‹œì‘
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUserId = user.uid;
                    } else {
                        // ì‚¬ìš©ìê°€ ì—†ì„ ê²½ìš° ìµëª… ID ìƒì„± (ë‹¤ì¤‘ ì‚¬ìš©ì ì•±ì´ë¯€ë¡œ ê³ ìœ  ID í•„ìš”)
                        // ì´ ë¶€ë¶„ì€ signInAnonymouslyê°€ ì‹¤íŒ¨í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì§€ë§Œ, ìœ„ì—ì„œ ì´ë¯¸ ì‹œë„í–ˆìœ¼ë¯€ë¡œ ê±°ì˜ ë°œìƒí•˜ì§€ ì•ŠìŒ
                        currentUserId = crypto.randomUUID();
                    }
                    console.log("Firebase initialized and user authenticated:", currentUserId);

                    // ì»¬ë ‰ì…˜ ì°¸ì¡° ì„¤ì • (public/data ê²½ë¡œ ì‚¬ìš©)
                    ratingsCollection = collection(db, `artifacts/${appId}/public/data/ratings`);
                    exclusionsCollection = collection(db, `artifacts/${appId}/public/data/exclusions`);

                    // --- ì´ˆê¸° ë°ì´í„° ë¡œë“œ ë° ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
                    initStarRatings(); // ë³„ì  ì´ˆê¸°í™” ë° ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                    updateReservationDeadlines(); // ì˜ˆì•½ ë§ˆê° ì‹œê°„ ì—…ë°ì´íŠ¸
                    updateExclusionSummary(); // ì œì™¸ ì‹ ì²­ ìš”ì•½ ì—…ë°ì´íŠ¸

                    // ëª¨ë“  ì œì™¸ ì‹ ì²­ì— ëŒ€í•œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ (ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë° ìš”ì•½ ì—…ë°ì´íŠ¸ìš©)
                    const tomorrowDate = getTomorrowDateString();
                    const allExclusionsQuery = query(exclusionsCollection, where("date", "==", tomorrowDate));

                    onSnapshot(allExclusionsQuery, (snapshot) => {
                        console.log("Exclusions data changed, updating UI...");
                        updateExclusionSummary(); // í˜„ì¬ ì‚¬ìš©ìì˜ ìš”ì•½ ì—…ë°ì´íŠ¸
                        if (document.getElementById('admin-dashboard-panel').classList.contains('active')) {
                            updateAdminDashboard(); // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
                        }
                    }, (error) => {
                        console.error("Error listening to exclusions:", error);
                    });

                    // ëª¨ë“  í‰ê°€ì— ëŒ€í•œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ (ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë° ë©”ë‰´ í‰ê°€ ì—…ë°ì´íŠ¸ìš©)
                    onSnapshot(ratingsCollection, (snapshot) => {
                        console.log("Ratings data changed, updating UI...");
                        // ëª¨ë“  ë©”ë‰´ í•­ëª©ì˜ í‰ê°€ë¥¼ ë‹¤ì‹œ ê³„ì‚°í•˜ê³  í‘œì‹œ
                        document.querySelectorAll('.menu-item').forEach(item => {
                            const mealTime = item.dataset.mealTime;
                            const menuName = item.querySelector('.menu-name').dataset.menuName;
                            const starsDiv = item.querySelector('.star-rating');
                            const ratingValueSpan = starsDiv.querySelector('.rating-value');
                            updateMenuItemRatingDisplay(mealTime, menuName, starsDiv.querySelectorAll('.star'), ratingValueSpan);
                        });
                        if (document.getElementById('admin-dashboard-panel').classList.contains('active')) {
                            updateAdminDashboard(); // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
                        }
                    }, (error) => {
                        console.error("Error listening to ratings:", error);
                    });
                });

            } catch (error) {
                console.error("Error initializing Firebase or Firestore:", error);
                const appContainer = document.querySelector('.app-container');
                const errorDiv = document.createElement('div');
                errorDiv.style.padding = '20px';
                errorDiv.style.backgroundColor = '#f8d7da';
                errorDiv.style.color = '#721c24';
                errorDiv.style.border = '1px solid #f5c6cb';
                errorDiv.style.borderRadius = '5px';
                errorDiv.style.margin = '20px';
                errorDiv.textContent = 'ì•± ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                appContainer.prepend(errorDiv);
            }
        }

        // DOM ë¡œë“œ í›„ Firebase ì´ˆê¸°í™” ì‹œì‘
        document.addEventListener('DOMContentLoaded', initializeFirebaseAndFirestore);


        // --- ì»¤ìŠ¤í…€ ì•Œë¦¼ ëª¨ë‹¬ ---
        function showCustomAlert(message) {
            const alertModal = document.getElementById('custom-alert-modal');
            const alertMessage = document.getElementById('custom-alert-message');
            alertMessage.textContent = message;
            alertModal.style.display = 'flex';
        }


        // --- ë‚ ì§œ ë° ì‹œê°„ ê´€ë ¨ í—¬í¼ í•¨ìˆ˜ ---
        function getTomorrowDateString() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const year = tomorrow.getFullYear();
            const month = (tomorrow.getMonth() + 1).toString().padStart(2, '0');
            const day = tomorrow.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getMealTypeName(mealType) {
            switch (mealType) {
                case 'breakfast':
                    return 'ì•„ì¹¨';
                case 'lunch':
                    return 'ì ì‹¬';
                case 'dinner':
                    return 'ì €ë…';
                default:
                    return '';
            }
        }


        // --- íƒ­ ì „í™˜ ê¸°ëŠ¥ (ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ) ---
        window.showTab = function (tabId) { // window.showTabìœ¼ë¡œ ë³€ê²½
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');

            navTabs.forEach(tab => tab.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            document.querySelector(`.nav-tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            // ê´€ë¦¬ì íƒ­ìœ¼ë¡œ ì „í™˜ ì‹œ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ì‹œë„
            if (tabId === 'admin' && document.getElementById('admin-dashboard-panel').style.display === 'block') {
                updateAdminDashboard();
            }
        };


        // --- ì‹ì‚¬ ë©”ë‰´ íƒ­ (í‰ê°€ ê¸°ëŠ¥) ---

        // ë³„ì  ì‹œê°ì  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStarDisplay(stars, ratingValue) {
            stars.forEach((star, index) => {
                const starValue = index + 1;
                if (ratingValue >= starValue) {
                    star.classList.add('full');
                    star.classList.remove('half');
                } else if (ratingValue > index && ratingValue < starValue) {
                    star.classList.add('half');
                    star.classList.remove('full');
                } else {
                    star.classList.remove('full');
                    star.classList.remove('half');
                }
            });
        }

        // íŠ¹ì • ë©”ë‰´ í•­ëª©ì˜ í‰ê·  í‰ê°€ë¥¼ Firestoreì—ì„œ ê°€ì ¸ì™€ UI ì—…ë°ì´íŠ¸
        async function updateMenuItemRatingDisplay(mealTime, menuName, stars, ratingValueSpan) {
            if (!ratingsCollection) {
                console.warn("Firestore ratingsCollection not initialized yet.");
                return;
            }
            try {
                // í•´ë‹¹ ë©”ë‰´ í•­ëª©ì— ëŒ€í•œ ëª¨ë“  í‰ê°€ë¥¼ Firestoreì—ì„œ ì¿¼ë¦¬
                const q = query(ratingsCollection,
                    where("mealTime", "==", mealTime),
                    where("menuName", "==", menuName)
                );

                const querySnapshot = await getDocs(q);
                let totalRating = 0;
                let numberOfRatings = 0;
                querySnapshot.forEach((doc) => {
                    totalRating += doc.data().value;
                    numberOfRatings++;
                });

                const average = numberOfRatings === 0 ? 0.0 : totalRating / numberOfRatings;

                updateStarDisplay(stars, average);
                ratingValueSpan.textContent = average.toFixed(1);

            } catch (e) {
                console.error("Error updating menu item rating display:", e);
            }
        }

        // ë³„ì  í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (Firestoreì— í‰ê°€ ì €ì¥)
        async function handleStarClick(event) {
            if (!currentUserId || !ratingsCollection) {
                showCustomAlert("ì‚¬ìš©ì ì¸ì¦ ì¤‘ì´ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                return;
            }

            const star = event.target;
            const ratingDiv = star.closest('.star-rating');
            const mealTime = ratingDiv.dataset.mealTime;
            const menuName = ratingDiv.dataset.menuName;

            const rect = star.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const starWidth = rect.width;
            // ë°˜ ë³„ì  í—ˆìš© (í´ë¦­ ìœ„ì¹˜ì— ë”°ë¼ 0.5ì  ë‹¨ìœ„ë¡œ)
            const value = clickX < starWidth / 2 ? parseInt(star.dataset.value) - 0.5 : parseInt(star.dataset.value);

            // ì‚¬ìš©ìë³„, ë©”ë‰´ë³„ ê³ ìœ í•œ ë¬¸ì„œ ID ìƒì„±
            const ratingDocId = `${currentUserId}_${mealTime}_${menuName}`;
            const docRef = doc(ratingsCollection, ratingDocId);

            try {
                // setDocì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
                await setDoc(docRef, {
                    userId: currentUserId,
                    mealTime: mealTime,
                    menuName: menuName,
                    value: value,
                    timestamp: new Date()
                });
                console.log("Rating saved successfully!");
                // onSnapshot ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ UIë¥¼ ì—…ë°ì´íŠ¸í•  ê²ƒì…ë‹ˆë‹¤.
            } catch (e) {
                console.error("Error adding/updating rating: ", e);
                showCustomAlert("í‰ê°€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

        // ë³„ì  ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function initStarRatings() {
            const starRatings = document.querySelectorAll('.star-rating');
            starRatings.forEach(ratingDiv => {
                const mealTime = ratingDiv.dataset.mealTime;
                const menuName = ratingDiv.dataset.menuName;
                const stars = ratingDiv.querySelectorAll('.star');
                const ratingValueSpan = ratingDiv.querySelector('.rating-value');

                // ì´ˆê¸° ë¡œë“œ ì‹œ í‰ê°€ í‘œì‹œ
                updateMenuItemRatingDisplay(mealTime, menuName, stars, ratingValueSpan);

                // ë³„ì  í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                stars.forEach((star) => {
                    star.removeEventListener('click', handleStarClick); // ì¤‘ë³µ ë°©ì§€
                    star.addEventListener('click', handleStarClick);
                    star.removeEventListener('mouseenter', handleStarHover);
                    star.addEventListener('mouseenter', handleStarHover);
                });

                // ë§ˆìš°ìŠ¤ê°€ ë³„ì  ì˜ì—­ì„ ë²—ì–´ë‚¬ì„ ë•Œ ì›ë˜ í‰ê°€ë¡œ ëŒì•„ê°€ê¸°
                ratingDiv.removeEventListener('mouseleave', handleStarMouseLeave);
                ratingDiv.addEventListener('mouseleave', handleStarMouseLeave);
            });
        }

        // ë³„ì  ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì‹œê°ì  íš¨ê³¼
        function handleStarHover(e) {
            const star = e.target;
            const ratingDiv = star.closest('.star-rating');
            const stars = ratingDiv.querySelectorAll('.star');
            const rect = star.getBoundingClientRect();
            const hoverX = e.clientX - rect.left;
            const starWidth = rect.width;
            const hoverValue = hoverX < starWidth / 2 ? parseInt(star.dataset.value) - 0.5 : parseInt(star.dataset.value);
            updateStarDisplay(stars, hoverValue);
        }

        // ë³„ì  ë§ˆìš°ìŠ¤ ë¦¬ë¸Œ ì‹œ ì›ë˜ í‰ê°€ë¡œ ë³µì›
        function handleStarMouseLeave(e) {
            const ratingDiv = e.target;
            const mealTime = ratingDiv.dataset.mealTime;
            const menuName = ratingDiv.dataset.menuName;
            const stars = ratingDiv.querySelectorAll('.star');
            const ratingValueSpan = ratingDiv.querySelector('.rating-value');
            updateMenuItemRatingDisplay(mealTime, menuName, stars, ratingValueSpan);
        }


        // --- ì‹ì‚¬ ì˜ˆì•½ íƒ­ (ì œì™¸ ì‹ ì²­ ê¸°ëŠ¥) ---

        const mealDeadlines = {
            breakfast: "00:00", // ìì •
            lunch: "09:00", // ì˜¤ì „ 9ì‹œ
            dinner: "15:30" // ì˜¤í›„ 3ì‹œ 30ë¶„
        };

        function updateReservationDeadlines() {
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1); // ë‚´ì¼ ë‚ ì§œ

            document.getElementById('deadline-breakfast').textContent = mealDeadlines.breakfast;
            document.getElementById('deadline-lunch').textContent = mealDeadlines.lunch;
            document.getElementById('deadline-dinner').textContent = mealDeadlines.dinner;

            const reservationButton = document.getElementById('reservation-button');
            let isPastDeadline = false;

            for (const mealType in mealDeadlines) {
                const deadlineTime = mealDeadlines[mealType];
                const [deadlineHour, deadlineMinute] = deadlineTime.split(':').map(Number);

                const deadlineDate = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), deadlineHour, deadlineMinute, 0, 0);

                if (now > deadlineDate) {
                    isPastDeadline = true;
                    break;
                }
            }

            if (isPastDeadline) {
                reservationButton.classList.add('disabled');
                reservationButton.textContent = 'ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ë§ˆê°';
            } else {
                reservationButton.classList.remove('disabled');
                reservationButton.textContent = 'ì‹ì‚¬ ì œì™¸ ì‹ ì²­';
            }
        }

        let currentModalMode = 'add'; // 'add' ë˜ëŠ” 'edit'
        let currentMealTypeBeingEdited = null; // ìˆ˜ì • ì¤‘ì¸ ì‹ì‚¬ ìœ í˜•

        function openExclusionModal() {
            const reservationButton = document.getElementById('reservation-button');
            if (reservationButton.classList.contains('disabled')) {
                showCustomAlert('ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ë§ˆê° ì‹œê°„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤.');
                return;
            }

            currentModalMode = 'add';
            document.getElementById('modal-title').textContent = 'ì‹ì‚¬ ì œì™¸ ì‹ ì²­';
            const container = document.getElementById('exclusion-entries-container');
            container.innerHTML = ''; // ê¸°ì¡´ í•­ëª© ì´ˆê¸°í™”
            addExclusionEntry(); // ê¸°ë³¸ í•­ëª© í•˜ë‚˜ ì¶”ê°€
            document.getElementById('exclusionModal').style.display = 'flex';
        }

        async function openExclusionModalForEdit(mealTypeToEdit) {
            const reservationButton = document.getElementById('reservation-button');
            if (reservationButton.classList.contains('disabled')) {
                showCustomAlert('ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ë§ˆê° ì‹œê°„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤.');
                return;
            }

            currentModalMode = 'edit';
            currentMealTypeBeingEdited = mealTypeToEdit;
            document.getElementById('modal-title').textContent = `${getMealTypeName(mealTypeToEdit)} ì‹ì‚¬ ì œì™¸ ìˆ˜ì •`;

            const container = document.getElementById('exclusion-entries-container');
            container.innerHTML = '';

            if (!currentUserId || !exclusionsCollection) {
                showCustomAlert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                return;
            }

            const tomorrowDate = getTomorrowDateString();
            try {
                const q = query(exclusionsCollection,
                    where("date", "==", tomorrowDate),
                    where("userId", "==", currentUserId),
                    where("mealType", "==", mealTypeToEdit)
                );
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        addExclusionEntry(data.mealType, data.reason, data.students);
                    });
                } else {
                    addExclusionEntry(mealTypeToEdit); // ê¸°ì¡´ ì‹ ì²­ì´ ì—†ìœ¼ë©´ ë¹ˆ í•­ëª© ì¶”ê°€
                }
            } catch (e) {
                console.error("Error loading exclusions for edit:", e);
                showCustomAlert("ê¸°ì¡´ ì œì™¸ ì‹ ì²­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }

            document.getElementById('exclusionModal').style.display = 'flex';
        }

        function closeExclusionModal() {
            document.getElementById('exclusionModal').style.display = 'none';
        }

        function addExclusionEntry(mealType = '', reason = '', students = []) {
            const container = document.getElementById('exclusion-entries-container');
            const entryCount = container.querySelectorAll('.exclusion-entry').length;
            const newEntry = document.createElement('div');
            newEntry.classList.add('exclusion-entry');
            newEntry.innerHTML = `
                <button type="button" class="remove-entry-btn" onclick="removeExclusionEntry(this)">&times;</button>
                <div class="form-group">
                    <label for="modal-meal-type-${entryCount}">ì‹ì‚¬ ì„ íƒ:</label>
                    <select id="modal-meal-type-${entryCount}">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="breakfast">ì•„ì¹¨</option>
                        <option value="lunch">ì ì‹¬</option>
                        <option value="dinner">ì €ë…</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-reason-${entryCount}">ì œì™¸ ì´ìœ :</label>
                    <textarea id="modal-reason-${entryCount}" placeholder="ì˜ˆ: íšŒì‹, ì™¸ì¶œ, ë³‘ì› ë°©ë¬¸ ë“±"></textarea>
                </div>
                <div class="form-group">
                    <label for="modal-students-${entryCount}">ì œì™¸ í•™ìƒ (í•œ ì¤„ì— í•œ ëª…ì”©):</label>
                    <textarea id="modal-students-${entryCount}" placeholder="ì˜ˆ:&#10;1206 ê¹€ìƒìœ¤&#10;1207 ê¹€ì‹œìš°"></textarea>
                </div>
            `;
            container.appendChild(newEntry);

            // ê°’ ì±„ìš°ê¸° (ìˆ˜ì • ëª¨ë“œìš©)
            if (mealType) {
                newEntry.querySelector(`select`).value = mealType;
            }
            if (reason) {
                newEntry.querySelector(`textarea[id^="modal-reason-"]`).value = reason;
            }
            if (students.length > 0) {
                newEntry.querySelector(`textarea[id^="modal-students-"]`).value = students.join('\n');
            }
        }

        function removeExclusionEntry(button) {
            const entryElement = button.closest('.exclusion-entry');
            entryElement.remove();
        }

        async function saveExclusions() {
            if (!currentUserId || !exclusionsCollection) {
                showCustomAlert("ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‚¬ìš©ì ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                return;
            }

            const container = document.getElementById('exclusion-entries-container');
            const entriesInModal = container.querySelectorAll('.exclusion-entry');
            const newOrEditedExclusions = [];
            let isValid = true;

            entriesInModal.forEach(entryElement => {
                const mealTypeSelect = entryElement.querySelector('select');
                const mealType = mealTypeSelect.value;
                const reason = entryElement.querySelector('textarea[id^="modal-reason-"]').value.trim();
                const studentsText = entryElement.querySelector('textarea[id^="modal-students-"]').value.trim();

                const students = studentsText.split('\n').map(s => s.trim()).filter(s => s !== '');

                if (!mealType) {
                    isValid = false;
                    showCustomAlert('ëª¨ë“  ì œì™¸ í•­ëª©ì˜ ì‹ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (students.length === 0) {
                    isValid = false;
                    showCustomAlert('ëª¨ë“  ì œì™¸ í•­ëª©ì— í•™ë²ˆ ì´ë¦„ì„ ìµœì†Œ í•œ ëª… ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (!reason) {
                    isValid = false;
                    showCustomAlert('ëª¨ë“  ì œì™¸ í•­ëª©ì˜ ì´ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                newOrEditedExclusions.push({
                    mealType: mealType,
                    reason: reason,
                    students: students
                });
            });

            if (!isValid) {
                return;
            }

            try {
                const tomorrowDate = getTomorrowDateString();

                // í˜„ì¬ ì‚¬ìš©ìì˜ ë‚´ì¼ ì œì™¸ ì‹ ì²­ì„ ëª¨ë‘ ì‚­ì œ
                const existingExclusionsQuery = query(exclusionsCollection,
                    where("date", "==", tomorrowDate),
                    where("userId", "==", currentUserId)
                );
                const existingExclusionsSnapshot = await getDocs(existingExclusionsQuery);
                const deletePromises = [];
                existingExclusionsSnapshot.forEach((doc) => {
                    deletePromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deletePromises);

                // ìƒˆë¡œìš´ ë˜ëŠ” ìˆ˜ì •ëœ ì œì™¸ ì‹ ì²­ì„ ì¶”ê°€
                const addPromises = [];
                newOrEditedExclusions.forEach(exclusion => {
                    addPromises.push(addDoc(exclusionsCollection, {
                        userId: currentUserId,
                        mealType: exclusion.mealType,
                        reason: exclusion.reason,
                        students: exclusion.students,
                        date: tomorrowDate,
                        timestamp: new Date()
                    }));
                });
                await Promise.all(addPromises);

                closeExclusionModal();
                showCustomAlert('ì‹ì‚¬ ì œì™¸ ì‹ ì²­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                // onSnapshot ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ UIë¥¼ ì—…ë°ì´íŠ¸í•  ê²ƒì…ë‹ˆë‹¤.

            } catch (e) {
                console.error("Error saving exclusions: ", e);
                showCustomAlert('ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ìš”ì•½ ì—…ë°ì´íŠ¸
        async function updateExclusionSummary() {
            const summaryContainer = document.getElementById('exclusion-summary-list');
            summaryContainer.innerHTML = '';

            if (!currentUserId || !exclusionsCollection) {
                document.getElementById('exclusion-summary-card').style.display = 'none';
                return;
            }

            const tomorrowDate = getTomorrowDateString();

            try {
                // í˜„ì¬ ì‚¬ìš©ìì˜ ë‚´ì¼ ì œì™¸ ì‹ ì²­ë§Œ ê°€ì ¸ì˜´
                const q = query(exclusionsCollection,
                    where("date", "==", tomorrowDate),
                    where("userId", "==", currentUserId)
                );

                const querySnapshot = await getDocs(q);

                const groupedExclusions = {
                    'breakfast': [],
                    'lunch': [],
                    'dinner': []
                };

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (groupedExclusions[data.mealType]) {
                        groupedExclusions[data.mealType].push(data);
                    }
                });

                const mealCategories = [{
                    key: 'breakfast',
                    label: 'ğŸŒ… ì•„ì¹¨'
                }, {
                    key: 'lunch',
                    label: 'ğŸ½ï¸ ì ì‹¬'
                }, {
                    key: 'dinner',
                    label: 'ğŸŒ™ ì €ë…'
                }];

                let hasAnyExclusion = false;
                mealCategories.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.classList.add('exclusion-summary-category');

                    const categoryHeader = document.createElement('h4');
                    categoryHeader.textContent = category.label;

                    const editButton = document.createElement('button');
                    editButton.classList.add('edit-summary-btn');
                    editButton.textContent = 'ìˆ˜ì •í•˜ê¸°';
                    editButton.onclick = () => openExclusionModalForEdit(category.key);
                    categoryHeader.appendChild(editButton);

                    categoryDiv.appendChild(categoryHeader);

                    const entriesForCategory = groupedExclusions[category.key];
                    if (entriesForCategory.length > 0) {
                        hasAnyExclusion = true;
                        entriesForCategory.forEach(entry => {
                            const summaryItem = document.createElement('div');
                            summaryItem.classList.add('exclusion-summary-item');

                            const studentNamesList = entry.students.map(s => `<li>${s}</li>`).join('');

                            summaryItem.innerHTML = `
                                <strong>ì œì™¸ í•™ìƒ: (${entry.students.length}ëª…)</strong>
                                <ul>
                                    ${studentNamesList}
                                </ul>
                                <p>ì´ìœ : ${entry.reason}</p>
                            `;
                            categoryDiv.appendChild(summaryItem);
                        });
                    } else {
                        const noEntryMessage = document.createElement('p');
                        noEntryMessage.classList.add('no-exclusion-message');
                        noEntryMessage.textContent = 'ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.';
                        categoryDiv.appendChild(noEntryMessage);
                    }
                    summaryContainer.appendChild(categoryDiv);
                });

                document.getElementById('exclusion-summary-card').style.display = 'block'; // ì‹ ì²­ ë‚´ì—­ì´ ìˆë“  ì—†ë“  ì¹´ë“œëŠ” í•­ìƒ í‘œì‹œ

            } catch (e) {
                console.error("Error updating exclusion summary:", e);
                document.getElementById('exclusion-summary-card').style.display = 'none'; // ì˜¤ë¥˜ ì‹œ ìˆ¨ê¹€
            }
        }


        // --- ê´€ë¦¬ì íƒ­ ---

        const ADMIN_PASSWORD = "admin"; // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë” ì•ˆì „í•œ ë°©ë²• ì‚¬ìš©

        function adminLogin() {
            const passwordInput = document.getElementById('admin-password');
            if (passwordInput.value === ADMIN_PASSWORD) {
                document.getElementById('admin-login-panel').style.display = 'none';
                document.getElementById('admin-dashboard-panel').style.display = 'block';
                updateAdminDashboard(); // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
            } else {
                showCustomAlert('ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.');
                passwordInput.value = '';
            }
        }

        async function updateAdminDashboard() {
            if (!db || !ratingsCollection || !exclusionsCollection) {
                console.warn("Firestore collections not initialized for admin dashboard.");
                return;
            }

            const adminMealRatingsSummary = document.getElementById('admin-meal-ratings-summary');
            adminMealRatingsSummary.innerHTML = '';

            const mealTimes = [{
                key: 'breakfast',
                label: 'ğŸŒ… ì•„ì¹¨'
            }, {
                key: 'lunch',
                label: 'ğŸ½ï¸ ì ì‹¬'
            }, {
                key: 'dinner',
                label: 'ğŸŒ™ ì €ë…'
            }];

            // ì‹ì‚¬ í‰ê°€ ìš”ì•½ ì—…ë°ì´íŠ¸
            for (const mealTimeData of mealTimes) {
                const mealTimeDiv = document.createElement('div');
                mealTimeDiv.classList.add('admin-section'); // admin-sub-section ëŒ€ì‹  admin-section ì‚¬ìš©
                const mealTimeHeader = document.createElement('h4');
                mealTimeHeader.textContent = mealTimeData.label;
                mealTimeDiv.appendChild(mealTimeHeader);

                const ul = document.createElement('ul');
                let hasRatings = false;

                // í•˜ë“œì½”ë”©ëœ ë©”ë‰´ ëª©ë¡ (ì‹¤ì œ ì•±ì—ì„œëŠ” Firestoreì—ì„œ ë©”ë‰´ ìì²´ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ)
                const staticMenuItems = {
                    breakfast: ["ë„¤ì½”ë§˜ë§ˆë®ë°¥", "ë¹„ìŠ¤í‚·", "ì‚¼ì¹˜ë°ë¦¬ì•¼ë¼êµ¬ì´", "ì‹œë¦¬ì–¼&ìš°ìœ "],
                    lunch: ["ëª©ì‚´í•„ë¼í”„", "ì°¨ì§€í‚¤ìƒëŸ¬ë“œ", "ì¥ê°ì¹˜í‚¨êµ¬ì´", "ë³µìˆ­ì•„"],
                    dinner: ["êµ¬ìš´ì£¼ë¨¹ë°¥", "í•´ë¬¼ì°Œê°œ", "ëˆíŒŒì´", "ì¿¨í”¼ìŠ¤", "ë°©ìš¸í† ë§ˆí† "]
                };

                const menuItemsForTime = staticMenuItems[mealTimeData.key] || [];
                if (menuItemsForTime.length === 0) {
                    const p = document.createElement('p');
                    p.textContent = 'ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    mealTimeDiv.appendChild(p);
                    adminMealRatingsSummary.appendChild(mealTimeDiv);
                    continue;
                }

                for (const menuName of menuItemsForTime) {
                    try {
                        // ëª¨ë“  ì‚¬ìš©ìì˜ í•´ë‹¹ ë©”ë‰´ í‰ê°€ë¥¼ ì¿¼ë¦¬
                        const q = query(ratingsCollection,
                            where("mealTime", "==", mealTimeData.key),
                            where("menuName", "==", menuName)
                        );
                        const querySnapshot = await getDocs(q);

                        let totalRating = 0;
                        let numberOfRatings = 0;
                        querySnapshot.forEach((doc) => {
                            totalRating += doc.data().value;
                            numberOfRatings++;
                        });

                        const average = numberOfRatings === 0 ? 0.0 : totalRating / numberOfRatings;

                        const li = document.createElement('li');
                        li.textContent = `${menuName}: í‰ê·  ${average.toFixed(1)}ì  (${numberOfRatings}ëª… í‰ê°€)`;
                        ul.appendChild(li);
                        if (numberOfRatings > 0) hasRatings = true;
                    } catch (e) {
                        console.error(`Error fetching ratings for ${menuName}:`, e);
                    }
                }

                if (!hasRatings) {
                    const p = document.createElement('p');
                    p.textContent = 'ì•„ì§ í‰ê°€ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    mealTimeDiv.appendChild(p);
                } else {
                    mealTimeDiv.appendChild(ul);
                }
                adminMealRatingsSummary.appendChild(mealTimeDiv);
            }

            // ì‹ì‚¬ ì œì™¸ ì‹ ì²­ í˜„í™© (ë‚´ì¼) ì—…ë°ì´íŠ¸
            const adminExclusionList = document.getElementById('admin-exclusion-list');
            adminExclusionList.innerHTML = '';

            const tomorrowDate = getTomorrowDateString();
            try {
                // ë‚´ì¼ì˜ ëª¨ë“  ì œì™¸ ì‹ ì²­ì„ ê°€ì ¸ì˜´ (ì‚¬ìš©ì í•„í„° ì—†ìŒ)
                const allExclusionsQuery = query(exclusionsCollection, where("date", "==", tomorrowDate));
                const allExclusionsSnapshot = await getDocs(allExclusionsQuery);

                const groupedExclusions = {
                    'breakfast': [],
                    'lunch': [],
                    'dinner': []
                };

                allExclusionsSnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (groupedExclusions[data.mealType]) {
                        groupedExclusions[data.mealType].push(data);
                    }
                });

                mealTimes.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.classList.add('admin-section');
                    const categoryHeader = document.createElement('h4');
                    categoryHeader.textContent = `${category.label} ì œì™¸ í•™ìƒ`;
                    categoryDiv.appendChild(categoryHeader);

                    const entriesForCategory = groupedExclusions[category.key];
                    if (entriesForCategory.length > 0) {
                        const ul = document.createElement('ul');
                        entriesForCategory.forEach(entry => {
                            entry.students.forEach(student => {
                                const li = document.createElement('li');
                                li.textContent = `${student} (ì´ìœ : ${entry.reason}, ì‹ ì²­ì: ${entry.userId.substring(0, 8)}...)`; // userId ì¼ë¶€ í‘œì‹œ
                                ul.appendChild(li);
                            });
                        });
                        categoryDiv.appendChild(ul);
                    } else {
                        const noEntryMessage = document.createElement('p');
                        noEntryMessage.textContent = 'ì œì™¸ ì‹ ì²­ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.';
                        categoryDiv.appendChild(noEntryMessage);
                    }
                    adminExclusionList.appendChild(categoryDiv);
                });
            } catch (e) {
                console.error("Error fetching admin exclusions:", e);
                adminExclusionList.innerHTML = '<p>ì œì™¸ ì‹ ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        function printAdminSummary() {
            // ì¸ì‡„ ê¸°ëŠ¥ (ë¸Œë¼ìš°ì € ê¸°ë³¸ ì¸ì‡„ ëŒ€í™” ìƒì ì‚¬ìš©)
            window.print();
        }

        // 30ì´ˆë§ˆë‹¤ ê¸‰ì‹ ìƒíƒœ ëœë¤ ì—…ë°ì´íŠ¸ (ë°ëª¨ìš©)
        setInterval(() => {
            const statusElements = document.querySelectorAll('.meal-status');
            const statuses = ['status-available', 'status-low', 'status-soldout'];
            const statusTexts = ['ì¶©ë¶„í•¨', 'ë¶€ì¡±í•¨', 'ë§¤ì§„'];

            statusElements.forEach(element => {
                const randomIndex = Math.floor(Math.random() * 3);
                element.className = `meal-status ${statuses[randomIndex]}`;
                element.textContent = statusTexts[randomIndex];
            });
        }, 30000);
    </script>

    <style>
        /* ê¸°ì¡´ CSSëŠ” ë³€ê²½ ì—†ì´ ìœ ì§€í•©ë‹ˆë‹¤. */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .app-container {
            max-width: 400px;
            width: 100%;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .user-id-display { /* ì´ í´ë˜ìŠ¤ëŠ” ì´ì œ ì‚¬ìš©ë˜ì§€ ì•Šì§€ë§Œ, CSSì—ì„œ ì‚­ì œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. */
            font-size: 0.7em;
            margin-top: 10px;
            opacity: 0.8;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            color: #666;
        }

        .nav-tab.active {
            background: white;
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
        }

        .tab-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .meal-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4CAF50;
        }

        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .meal-date {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .meal-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-available {
            background: #e8f5e8;
            color: #4CAF50;
        }

        .status-low {
            background: #fff3cd;
            color: #856404;
        }

        .status-soldout {
            background: #f8d7da;
            color: #721c24;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-info {
            flex: 1;
        }

        .menu-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .star-rating {
            display: flex;
            gap: 2px;
            align-items: center;
        }

        .star {
            width: 18px;
            height: 18px;
            cursor: pointer;
            position: relative;
            color: #ddd;
            transition: color 0.2s;
        }

        .star:before {
            content: 'â˜…';
            font-size: 18px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .star.full {
            color: #ffc107;
        }

        .star.half {
            background: linear-gradient(90deg, #ffc107 50%, #ddd 50%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .star.half:before {
            background: linear-gradient(90deg, #ffc107 50%, #ddd 50%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rating-value {
            margin-left: 8px;
            font-size: 12px;
            color: #666;
            min-width: 30px;
        }

        .notification {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .meal-time-section {
            margin-bottom: 25px;
        }

        .time-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-info {
            font-size: 12px;
            opacity: 0.9;
        }

        .menu-content {
            background: white;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 15px;
        }

        /* ì˜ˆì•½ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .reservation-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Adjusted font for the main header in reservation tab */
        #reservation .reservation-card h3 {
            font-size: 20px;
            /* Adjusted size */
            font-weight: 700;
            /* Adjusted weight */
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        /* Adjusted font for the summary card header */
        #exclusion-summary-card h3 {
            font-size: 20px;
            /* Adjusted size */
            font-weight: 700;
            /* Adjusted weight */
            margin-bottom: 15px;
            /* Slightly less margin than modal header */
            color: #333;
            text-align: center;
        }


        .reservation-info {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
            text-align: center;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            width: 100%;
            margin-top: 15px;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            padding-top: 60px;
            justify-content: center; /* ì¶”ê°€: ëª¨ë‹¬ ì¤‘ì•™ ì •ë ¬ */
            align-items: center; /* ì¶”ê°€: ëª¨ë‹¬ ì¤‘ì•™ ì •ë ¬ */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .exclusion-entry {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        .exclusion-entry label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .exclusion-entry input[type="text"],
        .exclusion-entry textarea,
        .exclusion-entry select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .exclusion-entry select {
            margin-bottom: 15px;
        }

        .exclusion-entry textarea {
            resize: vertical;
            min-height: 60px;
        }

        .exclusion-entry .remove-entry-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            float: right;
            margin-bottom: 10px;
        }

        .exclusion-entry .remove-entry-btn:hover {
            background: #c82333;
        }

        .add-exclusion-entry-in-modal {
            background: #17a2b8;
            /* Info blue */
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 10px;
            display: block;
            /* Make it a block element to take full width or easily center */
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .add-exclusion-entry-in-modal:hover {
            background: #138496;
        }


        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Summary card styles */
        .exclusion-summary-category {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .exclusion-summary-category:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .exclusion-summary-category h4 {
            font-size: 16px;
            color: #4CAF50;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exclusion-summary-item {
            padding: 10px 0;
            border-bottom: 1px solid #f5f5f5;
            margin-bottom: 5px;
            display: flex;
            flex-direction: column;
            /* Stack content vertically */
        }

        .exclusion-summary-item:last-child {
            border-bottom: none;
        }

        .exclusion-summary-item strong {
            color: #333;
        }

        .exclusion-summary-item ul {
            list-style-type: disc;
            padding-left: 20px;
            margin-top: 5px;
            font-size: 13px;
            color: #555;
        }

        .exclusion-summary-item p {
            margin-top: 5px;
            font-size: 13px;
            color: #555;
        }

        .deadline-info {
            font-size: 13px;
            color: #666;
            margin-top: 10px;
            text-align: left;
            line-height: 1.5;
        }

        .deadline-info strong {
            color: #333;
        }

        .edit-summary-btn {
            background: #f0f0f0;
            /* Light grey */
            color: #555;
            border: 1px solid #ccc;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            /* Space from text */
            flex-shrink: 0;
            /* Don't shrink the button */
        }

        .edit-summary-btn:hover {
            background: #e0e0e0;
        }

        .no-exclusion-message {
            font-size: 14px;
            color: #777;
            text-align: center;
            padding: 10px 0;
        }

        /* Admin Tab Styles */
        .admin-login-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .admin-login-card h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
        }

        .admin-login-card input[type="password"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
        }

        .admin-login-card .btn {
            width: auto;
            padding: 10px 30px;
            margin-top: 0;
        }

        .admin-login-card .btn:hover {
            background: #45a049;
        }

        .admin-dashboard-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .admin-dashboard-card h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .admin-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .admin-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .admin-section h4 {
            font-size: 16px;
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .admin-section p {
            font-size: 14px;
            color: #555;
            margin-bottom: 5px;
        }

        .admin-section ul {
            list-style-type: none;
            padding-left: 0;
        }

        .admin-section ul li {
            background: #f8f8f8;
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 5px;
            font-size: 13px;
            color: #444;
        }

        .admin-section ul li:last-child {
            margin-bottom: 0;
        }

        .admin-section .btn-print {
            background: #007bff;
            /* Blue */
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 13px;
            margin-top: 10px;
            width: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .admin-section .btn-print:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <div class="header">
            <h1>ğŸ½ï¸ ê¸‰ì‹ ë§¤ë‹ˆì €</h1>
            <p>ìŠ¤ë§ˆíŠ¸í•œ ê¸‰ì‹ ì‹œìŠ¤í…œìœ¼ë¡œ ë” ë‚˜ì€ ì‹ì‚¬ë¥¼</p>
            <!-- ì‚¬ìš©ì ID í‘œì‹œ div ì œê±°ë¨ -->
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('meals')">ê¸‰ì‹ ë©”ë‰´</button>
            <button class="nav-tab" onclick="showTab('reservation')">ì‹ì‚¬ ì œì™¸ ì‹ ì²­</button>
            <button class="nav-tab" onclick="showTab('admin')">ê´€ë¦¬ì</button>
        </div>

        <div id="meals" class="tab-content active">
            <div class="meal-time-section">
                <div class="time-header">
                    <span>ğŸŒ… ì•„ì¹¨ ê¸‰ì‹</span>
                </div>
                <div class="menu-content">
                    <div class="meal-header">
                        <div class="meal-date">2025ë…„ 7ì›” 3ì¼ (ëª©)</div>
                    </div>
                    <div class="menu-item" data-meal-time="breakfast">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ë„¤ì½”ë§˜ë§ˆë®ë°¥">ë„¤ì½”ë§˜ë§ˆë®ë°¥</div>
                        </div>
                        <div class="star-rating" data-meal-time="breakfast" data-menu-name="ë„¤ì½”ë§˜ë§ˆë®ë°¥">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="breakfast">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ë¹„ìŠ¤í‚·">ë¹„ìŠ¤í‚·</div>
                        </div>
                        <div class="star-rating" data-meal-time="breakfast" data-menu-name="ë¹„ìŠ¤í‚·">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="breakfast">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì‚¼ì¹˜ë°ë¦¬ì•¼ë¼êµ¬ì´">ì‚¼ì¹˜ë°ë¦¬ì•¼ë¼êµ¬ì´</div>
                        </div>
                        <div class="star-rating" data-meal-time="breakfast" data-menu-name="ì‚¼ì¹˜ë°ë¦¬ì•¼ë¼êµ¬ì´">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="breakfast">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì‹œë¦¬ì–¼&ìš°ìœ ">ì‹œë¦¬ì–¼&ìš°ìœ </div>
                        </div>
                        <div class="star-rating" data-meal-time="breakfast" data-menu-name="ì‹œë¦¬ì–¼&ìš°ìœ ">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="meal-time-section">
                <div class="time-header">
                    <span>ğŸ½ï¸ ì ì‹¬ ê¸‰ì‹</span>
                </div>
                <div class="menu-content">
                    <div class="meal-header">
                        <div class="meal-date">2025ë…„ 7ì›” 3ì¼ (ëª©)</div>
                    </div>
                    <div class="menu-item" data-meal-time="lunch">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ëª©ì‚´í•„ë¼í”„">ëª©ì‚´í•„ë¼í”„</div>
                        </div>
                        <div class="star-rating" data-meal-time="lunch" data-menu-name="ëª©ì‚´í•„ë¼í”„">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="lunch">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì°¨ì§€í‚¤ìƒëŸ¬ë“œ">ì°¨ì§€í‚¤ìƒëŸ¬ë“œ</div>
                        </div>
                        <div class="star-rating" data-meal-time="lunch" data-menu-name="ì°¨ì§€í‚¤ìƒëŸ¬ë“œ">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="lunch">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì¥ê°ì¹˜í‚¨êµ¬ì´">ì¥ê°ì¹˜í‚¨êµ¬ì´</div>
                        </div>
                        <div class="star-rating" data-meal-time="lunch" data-menu-name="ì¥ê°ì¹˜í‚¨êµ¬ì´">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="lunch">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ë³µìˆ­ì•„">ë³µìˆ­ì•„</div>
                        </div>
                        <div class="star-rating" data-meal-time="lunch" data-menu-name="ë³µìˆ­ì•„">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="meal-time-section">
                <div class="time-header">
                    <span>ğŸŒ™ ì €ë… ê¸‰ì‹</span>
                </div>
                <div class="menu-content">
                    <div class="meal-header">
                        <div class="meal-date">2025ë…„ 7ì›” 3ì¼ (ëª©)</div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="êµ¬ìš´ì£¼ë¨¹ë°¥">êµ¬ìš´ì£¼ë¨¹ë°¥</div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="êµ¬ìš´ì£¼ë¨¹ë°¥">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="í•´ë¬¼ì°Œê°œ">í•´ë¬¼ì°Œê°œ</div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="í•´ë¬¼ì°Œê°œ">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ëˆíŒŒì´">ëˆíŒŒì´</div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="ëˆíŒŒì´">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì¿¨í”¼ìŠ¤">ì¿¨í”¼ìŠ¤</div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="ì¿¨í”¼ìŠ¤">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ë°©ìš¸í† ë§ˆí† ">ë°©ìš¸í† ë§ˆí† </div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="ë°©ìš¸í† ë§ˆí† ">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="reservation" class="tab-content">
            <div class="reservation-card">
                <h3>ë‚´ì¼ ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ë§ˆê°</h3>
                <div class="deadline-info">
                    <p>ë‚´ì¼ ì‹ì‚¬ ì œì™¸ ì‹ ì²­ì€ ì˜¤ëŠ˜ ë§ˆê°ë©ë‹ˆë‹¤.</p>
                    <ul>
                        <li><strong>ì•„ì¹¨:</strong> <span id="deadline-breakfast">00:00</span></li>
                        <li><strong>ì ì‹¬:</strong> <span id="deadline-lunch">00:00</span></li>
                        <li><strong>ì €ë…:</strong> <span id="deadline-dinner">00:00</span></li>
                    </ul>
                    <p>ë§ˆê° ì‹œê°„ ì´í›„ì—ëŠ” ì‹ ì²­í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
                <button class="btn" id="reservation-button" onclick="openExclusionModal()">ì‹ì‚¬ ì œì™¸ ì‹ ì²­</button>
            </div>

            <div class="reservation-card" id="exclusion-summary-card">
                <h3>ë‚´ì¼ ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ë‚´ì—­</h3>
                <div id="exclusion-summary-list">
                    <!-- Exclusion summaries will be loaded here -->
                </div>
            </div>
        </div>

        <div id="admin" class="tab-content">
            <div class="admin-login-card" id="admin-login-panel">
                <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
                <input type="password" id="admin-password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button class="btn" onclick="adminLogin()">ë¡œê·¸ì¸</button>
            </div>

            <div class="admin-dashboard-card" id="admin-dashboard-panel" style="display: none;">
                <h3>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h3>

                <div class="admin-section">
                    <h4>ì‹ì‚¬ í‰ê°€ ìš”ì•½</h4>
                    <div id="admin-meal-ratings-summary">
                        <!-- Meal ratings summary will be loaded here -->
                    </div>
                </div>

                <div class="admin-section">
                    <h4>ì‹ì‚¬ ì œì™¸ ì‹ ì²­ í˜„í™© (ë‚´ì¼)</h4>
                    <div id="admin-exclusion-list">
                        <!-- Exclusion list will be loaded here -->
                    </div>
                </div>
                <button class="btn btn-print" onclick="printAdminSummary()">ìš”ì•½ ì¸ì‡„</button>
            </div>
        </div>
    </div>

    <!-- Exclusion Request Modal -->
    <div id="exclusionModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeExclusionModal()">&times;</span>
            <h3 id="modal-title">ì‹ì‚¬ ì œì™¸ ì‹ ì²­</h3>

            <div id="exclusion-entries-container">
                <!-- Exclusion entry forms will be added here -->
            </div>

            <button class="add-exclusion-entry-in-modal" onclick="addExclusionEntry()">+ í•­ëª© ì¶”ê°€</button>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeExclusionModal()">ì·¨ì†Œ</button>
                <button class="btn" onclick="saveExclusions()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="modal">
        <div class="modal-content" style="max-width: 300px; text-align: center;">
            <h3 style="color: #4CAF50; margin-bottom: 15px;">ì•Œë¦¼</h3>
            <p id="custom-alert-message"></p>
            <button class="btn" onclick="document.getElementById('custom-alert-modal').style.display = 'none'" style="margin-top: 20px; width: 100px;">í™•ì¸</button>
        </div>
    </div>
</body>

</html>
