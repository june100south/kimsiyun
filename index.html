<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸‰ì‹ ë§¤ë‹ˆì € - ìŠ¤ë§ˆíŠ¸ ê¸‰ì‹ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            color: #666;
        }

        .nav-tab.active {
            background: white;
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
        }

        .tab-content {
            display: none;
            padding: 20px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        .meal-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4CAF50;
        }

        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .meal-date {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .meal-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-available {
            background: #e8f5e8;
            color: #4CAF50;
        }

        .status-low {
            background: #fff3cd;
            color: #856404;
        }

        .status-soldout {
            background: #f8d7da;
            color: #721c24;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-info {
            flex: 1;
        }

        .menu-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .star-rating {
            display: flex;
            gap: 2px;
            align-items: center;
        }

        .star {
            width: 18px;
            height: 18px;
            cursor: pointer;
            position: relative;
            color: #ddd;
            transition: color 0.2s;
        }

        .star:before {
            content: 'â˜…';
            font-size: 18px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .star.full {
            color: #ffc107;
        }

        .star.half {
            background: linear-gradient(90deg, #ffc107 50%, #ddd 50%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .star.half:before {
            background: linear-gradient(90deg, #ffc107 50%, #ddd 50%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rating-value {
            margin-left: 8px;
            font-size: 12px;
            color: #666;
            min-width: 30px;
        }

        .notification {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .meal-time-section {
            margin-bottom: 25px;
        }

        .time-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-info {
            font-size: 12px;
            opacity: 0.9;
        }

        .menu-content {
            background: white;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 15px;
        }

        /* ì˜ˆì•½ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .reservation-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Adjusted font for the main header in reservation tab */
        #reservation .reservation-card h3 {
            font-size: 20px;
            /* Adjusted size */
            font-weight: 700;
            /* Adjusted weight */
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        /* Adjusted font for the summary card header */
        #exclusion-summary-card h3 {
            font-size: 20px;
            /* Adjusted size */
            font-weight: 700;
            /* Adjusted weight */
            margin-bottom: 15px;
            /* Slightly less margin than modal header */
            color: #333;
            text-align: center;
        }


        .reservation-info {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
            text-align: center;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            width: 100%;
            margin-top: 15px;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .exclusion-entry {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        .exclusion-entry label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .exclusion-entry input[type="text"],
        .exclusion-entry textarea,
        .exclusion-entry select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .exclusion-entry select {
            margin-bottom: 15px;
        }

        .exclusion-entry textarea {
            resize: vertical;
            min-height: 60px;
        }

        .exclusion-entry .remove-entry-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            float: right;
            margin-bottom: 10px;
        }

        .exclusion-entry .remove-entry-btn:hover {
            background: #c82333;
        }

        .add-exclusion-entry-in-modal {
            background: #17a2b8;
            /* Info blue */
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 10px;
            display: block;
            /* Make it a block element to take full width or easily center */
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .add-exclusion-entry-in-modal:hover {
            background: #138496;
        }


        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Summary card styles */
        .exclusion-summary-category {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .exclusion-summary-category:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .exclusion-summary-category h4 {
            font-size: 16px;
            color: #4CAF50;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exclusion-summary-item {
            padding: 10px 0;
            border-bottom: 1px solid #f5f5f5;
            margin-bottom: 5px;
            display: flex;
            flex-direction: column;
            /* Stack content vertically */
        }

        .exclusion-summary-item:last-child {
            border-bottom: none;
        }

        .exclusion-summary-item strong {
            color: #333;
        }

        .exclusion-summary-item ul {
            list-style-type: disc;
            padding-left: 20px;
            margin-top: 5px;
            font-size: 13px;
            color: #555;
        }

        .exclusion-summary-item p {
            margin-top: 5px;
            font-size: 13px;
            color: #555;
        }

        .deadline-info {
            font-size: 13px;
            color: #666;
            margin-top: 10px;
            text-align: left;
            line-height: 1.5;
        }

        .deadline-info strong {
            color: #333;
        }

        .edit-summary-btn {
            background: #f0f0f0;
            /* Light grey */
            color: #555;
            border: 1px solid #ccc;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            /* Space from text */
            flex-shrink: 0;
            /* Don't shrink the button */
        }

        .edit-summary-btn:hover {
            background: #e0e0e0;
        }

        .no-exclusion-message {
            font-size: 14px;
            color: #777;
            text-align: center;
            padding: 10px 0;
        }

        /* Admin Tab Styles */
        .admin-login-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .admin-login-card h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
        }

        .admin-login-card input[type="password"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
        }

        .admin-login-card .btn {
            width: auto;
            padding: 10px 30px;
            margin-top: 0;
        }

        .admin-dashboard-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .admin-dashboard-card h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .admin-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .admin-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .admin-section h4 {
            font-size: 16px;
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .admin-section p {
            font-size: 14px;
            color: #555;
            margin-bottom: 5px;
        }

        .admin-section ul {
            list-style-type: none;
            padding-left: 0;
        }

        .admin-section ul li {
            background: #f8f8f8;
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 5px;
            font-size: 13px;
            color: #444;
        }

        .admin-section ul li:last-child {
            margin-bottom: 0;
        }

        .admin-section .btn-print {
            background: #007bff;
            /* Blue */
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 13px;
            margin-top: 10px;
            width: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .admin-section .btn-print:hover {
            background: #0056b3;
        }
    </style>
<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, setDoc, query, orderBy, limit, addDoc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js"; // ì¸ì¦ì´ í•„ìš”í•˜ë‹¤ë©´

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyABCMlic-HTmOW_Cu07o4Ylay5Q39ef7MM",
            authDomain: "sample-firebase-ai-app-922f1.firebaseapp.com",
            projectId: "sample-firebase-ai-app-922f1",
            storageBucket: "sample-firebase-ai-app-922f1.firebasestorage.app",
            messagingSenderId: "875562026784",
            appId: "1:875562026784:web:7148c489a807bcc240b945"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); // ì¸ì¦ ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤ë©´

        // Firestore ì»¬ë ‰ì…˜ ì°¸ì¡° (í•„ìš”ì— ë”°ë¼ ì¶”ê°€)
        window.db = db; // ì „ì—­ ì ‘ê·¼ì„ ìœ„í•´ window ê°ì²´ì— í• ë‹¹
        window.auth = auth; // ì¸ì¦ ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤ë©´

        window.menusCollection = collection(db, "menus");
        window.ratingsCollection = collection(db, "ratings");
        window.exclusionsCollection = collection(db, "exclusions");
        window.deadlinesCollection = collection(db, "deadlines");

    </script>
</head>

<body>
    <div class="app-container">
        <div class="header">
            <h1>ğŸ½ï¸ ê¸‰ì‹ ë§¤ë‹ˆì €</h1>
            <p>ìŠ¤ë§ˆíŠ¸í•œ ê¸‰ì‹ ì‹œìŠ¤í…œìœ¼ë¡œ ë” ë‚˜ì€ ì‹ì‚¬ë¥¼</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('meals')">ê¸‰ì‹ ë©”ë‰´</button>
            <button class="nav-tab" onclick="showTab('reservation')">ì‹ì‚¬ ì œì™¸ ì‹ ì²­</button>
            <button class="nav-tab" onclick="showTab('admin')">ê´€ë¦¬ì</button>
        </div>

        <div id="meals" class="tab-content active">
            <div class="meal-time-section">
                <div class="time-header">
                    <span>ğŸŒ… ì•„ì¹¨ ê¸‰ì‹</span>
                </div>
                <div class="menu-content">
                    <div class="meal-header">
                        <div class="meal-date">2025ë…„ 7ì›” 3ì¼ (ëª©)</div>
                    </div>
                    <div class="menu-item" data-meal-time="breakfast">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ë„¤ì½”ë§˜ë§ˆë®ë°¥">ë„¤ì½”ë§˜ë§ˆë®ë°¥</div>
                        </div>
                        <div class="star-rating" data-meal-time="breakfast" data-menu-name="ë„¤ì½”ë§˜ë§ˆë®ë°¥">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="breakfast">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ë¹„ìŠ¤í‚·">ë¹„ìŠ¤í‚·</div>
                        </div>
                        <div class="star-rating" data-meal-time="breakfast" data-menu-name="ë¹„ìŠ¤í‚·">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="breakfast">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì‚¼ì¹˜ë°ë¦¬ì•¼ë¼êµ¬ì´">ì‚¼ì¹˜ë°ë¦¬ì•¼ë¼êµ¬ì´</div>
                        </div>
                        <div class="star-rating" data-meal-time="breakfast" data-menu-name="ì‚¼ì¹˜ë°ë¦¬ì•¼ë¼êµ¬ì´">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="breakfast">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì‹œë¦¬ì–¼&ìš°ìœ ">ì‹œë¦¬ì–¼&ìš°ìœ </div>
                        </div>
                        <div class="star-rating" data-meal-time="breakfast" data-menu-name="ì‹œë¦¬ì–¼&ìš°ìœ ">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="meal-time-section">
                <div class="time-header">
                    <span>ğŸ½ï¸ ì ì‹¬ ê¸‰ì‹</span>
                </div>
                <div class="menu-content">
                    <div class="meal-header">
                        <div class="meal-date">2025ë…„ 7ì›” 3ì¼ (ëª©)</div>
                    </div>
                    <div class="menu-item" data-meal-time="lunch">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ëª©ì‚´í•„ë¼í”„">ëª©ì‚´í•„ë¼í”„</div>
                        </div>
                        <div class="star-rating" data-meal-time="lunch" data-menu-name="ëª©ì‚´í•„ë¼í”„">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="lunch">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì°¨ì§€í‚¤ìƒëŸ¬ë“œ">ì°¨ì§€í‚¤ìƒëŸ¬ë“œ</div>
                        </div>
                        <div class="star-rating" data-meal-time="lunch" data-menu-name="ì°¨ì§€í‚¤ìƒëŸ¬ë“œ">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="lunch">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì¥ê°ì¹˜í‚¨êµ¬ì´">ì¥ê°ì¹˜í‚¨êµ¬ì´</div>
                        </div>
                        <div class="star-rating" data-meal-time="lunch" data-menu-name="ì¥ê°ì¹˜í‚¨êµ¬ì´">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="lunch">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ë³µìˆ­ì•„">ë³µìˆ­ì•„</div>
                        </div>
                        <div class="star-rating" data-meal-time="lunch" data-menu-name="ë³µìˆ­ì•„">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="meal-time-section">
                <div class="time-header">
                    <span>ğŸŒ™ ì €ë… ê¸‰ì‹</span>
                </div>
                <div class="menu-content">
                    <div class="meal-header">
                        <div class="meal-date">2025ë…„ 7ì›” 3ì¼ (ëª©)</div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="êµ¬ìš´ì£¼ë¨¹ë°¥">êµ¬ìš´ì£¼ë¨¹ë°¥</div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="êµ¬ìš´ì£¼ë¨¹ë°¥">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="í•´ë¬¼ì°Œê°œ">í•´ë¬¼ì°Œê°œ</div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="í•´ë¬¼ì°Œê°œ">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ëˆíŒŒì´">ëˆíŒŒì´</div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="ëˆíŒŒì´">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ì¿¨í”¼ìŠ¤">ì¿¨í”¼ìŠ¤</div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="ì¿¨í”¼ìŠ¤">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                    <div class="menu-item" data-meal-time="dinner">
                        <div class="menu-info">
                            <div class="menu-name" data-menu-name="ë°©ìš¸í† ë§ˆí† ">ë°©ìš¸í† ë§ˆí† </div>
                        </div>
                        <div class="star-rating" data-meal-time="dinner" data-menu-name="ë°©ìš¸í† ë§ˆí† ">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                            <span class="rating-value">0.0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="reservation" class="tab-content">
            <div class="reservation-card">
                <h3>ë‚´ì¼ (<span id="next-day-date"></span>) ì‹ì‚¬ ì œì™¸ ì‹ ì²­</h3>
                <p class="reservation-info">
                    ë‚´ì¼ ê¸‰ì‹ì„ ë¨¹ì§€ ì•Šì„ í•™ìƒë“¤ì˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.<br>
                    ì‹ ì²­ ë§ˆê° ì‹œê°„ ì´í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                </p>
                <div class="deadline-info">
                    <strong>ë§ˆê° ì‹œê°„:</strong><br>
                    - ì•„ì¹¨: <span id="deadline-breakfast"></span><br>
                    - ì ì‹¬: <span id="deadline-lunch"></span><br>
                    - ì €ë…: <span id="deadline-dinner"></span>
                </div>
                <button class="btn" onclick="openExclusionModalForNew()">ìƒˆë¡œìš´ ì‹ì‚¬ ì œì™¸ ì‹ ì²­</button>
            </div>

            <div class="reservation-card" id="exclusion-summary-card">
                <h3>ë‚´ì¼ ì‹ì‚¬ ì œì™¸ ì‹ ì²­ í˜„í™©</h3>
                <div id="exclusion-summary-list">
                    </div>
            </div>
        </div>

        <div id="admin" class="tab-content">
            <div class="admin-login-card" id="admin-login-panel">
                <h3>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
                <input type="password" id="admin-password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button class="btn" onclick="checkAdminPassword()">ë¡œê·¸ì¸</button>
                <p id="password-error" style="color: red; margin-top: 10px; display: none;">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</p>
            </div>

            <div class="admin-dashboard-card" id="admin-dashboard-panel" style="display: none;">
                <h3>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h3>

                <div class="admin-section">
                    <h4>ê¸‰ì‹ í‰ì  í†µê³„</h4>
                    <div id="admin-meal-ratings-summary">
                        </div>
                    <button class="btn btn-print" onclick="printMealEvaluations()">í‰ì  í†µê³„ ì¶œë ¥/ì €ì¥</button>
                </div>

                <div class="admin-section">
                    <h4>ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ëª©ë¡</h4>
                    <div id="admin-exclusion-list">
                        </div>
                    <button class="btn btn-print" onclick="printExclusionList()">ì œì™¸ ì‹ ì²­ ëª…ë‹¨ ì¶œë ¥/ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>

    <div id="exclusionModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeExclusionModal()">&times;</span>
            <h3 id="modal-title">ë‚´ì¼ ì‹ì‚¬ ì œì™¸ ì‹ ì²­</h3>
            <div id="exclusion-entries-container">
                </div>
            <button type="button" class="add-exclusion-entry-in-modal" onclick="addExclusionEntry()">í•­ëª© ì¶”ê°€</button>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeExclusionModal()">ì·¨ì†Œ</button>
                <button class="btn" onclick="saveExclusions()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // Data to store exclusions
        let mealExclusions = [];
        let currentModalMode = 'new'; // 'new' or 'edit'
        let currentMealTypeBeingEdited = ''; // 'breakfast', 'lunch', 'dinner' (only for 'edit' mode)

        // Global variable to store current date for comparison with deadlines
        let nextMealDate;

        // Data to store individual meal ratings per menu item
        // Each menu item now stores a Map where the key is a "pseudo-user ID" (e.g., a session ID or just 'user')
        // and the value is their last rating. This ensures only one rating per "user" per menu item.
        // For this simplified example, we'll use a fixed 'user1' as the key to simulate a single user.
        let mealRatings = {
            breakfast: {
                "ë„¤ì½”ë§˜ë§ˆë®ë°¥": new Map(),
                "ë¹„ìŠ¤í‚·": new Map(),
                "ì‚¼ì¹˜ë°ë¦¬ì•¼ë¼êµ¬ì´": new Map(),
                "ì‹œë¦¬ì–¼&ìš°ìœ ": new Map()
            },
            lunch: {
                "ëª©ì‚´í•„ë¼í”„": new Map(),
                "ì°¨ì§€í‚¤ìƒëŸ¬ë“œ": new Map(),
                "ì¥ê°ì¹˜í‚¨êµ¬ì´": new Map(),
                "ë³µìˆ­ì•„": new Map()
            },
            dinner: {
                "êµ¬ìš´ì£¼ë¨¹ë°¥": new Map(),
                "í•´ë¬¼ì°Œê°œ": new Map(),
                "ëˆíŒŒì´": new Map(),
                "ì¿¨í”¼ìŠ¤": new Map(),
                "ë°©ìš¸í† ë§ˆí† ": new Map()
            }
        };

        const PSEUDO_USER_ID = 'user1'; // Simulate a single user's rating


        function showTab(tabName) {
            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'reservation') {
                updateReservationDeadlines();
                updateExclusionSummary();
            } else if (tabName === 'admin') {
                document.getElementById('admin-login-panel').style.display = 'block';
                document.getElementById('admin-dashboard-panel').style.display = 'none';
                document.getElementById('admin-password').value = '';
                document.getElementById('password-error').style.display = 'none';
            }
        }

        // ë³„ì  ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        function initStarRatings() {
            const starRatings = document.querySelectorAll('.star-rating');
            starRatings.forEach(ratingDiv => {
                const mealTime = ratingDiv.dataset.mealTime;
                const menuName = ratingDiv.dataset.menuName; // Get individual menu name
                const stars = ratingDiv.querySelectorAll('.star');
                const ratingValueSpan = ratingDiv.querySelector('.rating-value');

                // Initial display based on stored data
                updateMenuItemRatingDisplay(mealTime, menuName, stars, ratingValueSpan);


                stars.forEach((star, index) => {
                    star.addEventListener('click', (e) => {
                        const rect = star.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const starWidth = rect.width;
                        const value = clickX < starWidth / 2 ? index + 0.5 : index + 1;

                        // Store the rating for the specific menu item by the pseudo-user ID
                        if (!mealRatings[mealTime][menuName]) {
                            mealRatings[mealTime][menuName] = new Map(); // Initialize if somehow missing
                        }
                        mealRatings[mealTime][menuName].set(PSEUDO_USER_ID, value); // Overwrite previous rating

                        // Recalculate and update display for this specific menu item
                        updateMenuItemRatingDisplay(mealTime, menuName, stars, ratingValueSpan);

                        // If admin dashboard is open, update it
                        if (document.getElementById('admin-dashboard-panel').style.display === 'block') {
                            updateAdminDashboard();
                        }
                    });

                    star.addEventListener('mouseenter', (e) => {
                        const rect = star.getBoundingClientRect();
                        const hoverX = e.clientX - rect.left;
                        const starWidth = rect.width;
                        const hoverValue = hoverX < starWidth / 2 ? index + 0.5 : index + 1;
                        updateStarDisplay(stars, hoverValue); // Use temporary hover value
                    });
                });

                ratingDiv.addEventListener('mouseleave', () => {
                    // Revert to current actual average rating on mouse leave
                    updateMenuItemRatingDisplay(mealTime, menuName, stars, ratingValueSpan);
                });
            });
        }

        // Helper to update star display (full/half stars)
        function updateStarDisplay(stars, rating) {
            stars.forEach((star, index) => {
                star.classList.remove('full', 'half');
                if (rating >= index + 1) {
                    star.classList.add('full');
                } else if (rating >= index + 0.5) {
                    star.classList.add('half');
                }
            });
        }

        // Helper to calculate average and update display for a specific menu item
        // Removed voterCountSpan as it's not displayed on the main meal page anymore.
        function updateMenuItemRatingDisplay(mealTime, menuName, stars, ratingValueSpan) {
            const ratingsMap = mealRatings[mealTime][menuName] || new Map();
            const ratingsArray = Array.from(ratingsMap.values()); // Convert Map values to array
            const average = ratingsArray.length === 0 ? 0.0 : ratingsArray.reduce((acc, curr) => acc + curr, 0) / ratingsArray.length;

            updateStarDisplay(stars, average);
            ratingValueSpan.textContent = average.toFixed(1);
            // Removed voterCountSpan update as per new requirement
        }


        function getFormattedDate(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const dayOfWeek = days[date.getDay()];
            return `${year}ë…„ ${month}ì›” ${day}ì¼ (${dayOfWeek})`;
        }

        function formatTime(date) {
            let hours = date.getHours();
            let minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';
            hours = hours % 12;
            hours = hours ? hours : 12;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            return `${ampm} ${hours}ì‹œ ${minutes}ë¶„`;
        }

        const mealDeadlines = {
            'breakfast': (now, nextMealDate) => {
                const nextDayWeekday = nextMealDate.getDay();
                const deadline = new Date(now);
                deadline.setHours(23, 59, 59, 999);
                return (nextDayWeekday >= 1 && nextDayWeekday <= 5 && now < deadline);
            },
            'lunch': (now, nextMealDate) => {
                const deadline = new Date(nextMealDate);
                deadline.setHours(9, 0, 0, 0);
                return now < deadline;
            },
            'dinner': (now, nextMealDate) => {
                const deadline = new Date(nextMealDate);
                deadline.setHours(15, 30, 0, 0);
                return now < deadline;
            }
        };

        function updateReservationDeadlines() {
            const now = new Date();
            nextMealDate = new Date(now);
            nextMealDate.setDate(now.getDate() + 1);

            document.getElementById('next-day-date').textContent = getFormattedDate(nextMealDate);

            const breakfastDeadlineDate = new Date(now);
            breakfastDeadlineDate.setHours(23, 59, 59, 999);
            document.getElementById('deadline-breakfast').textContent = `ì „ë‚  ${formatTime(breakfastDeadlineDate)}ê¹Œì§€`;

            const lunchDeadlineDate = new Date(nextMealDate);
            lunchDeadlineDate.setHours(9, 0, 0, 0);
            document.getElementById('deadline-lunch').textContent = `ì•„ì¹¨ ${formatTime(lunchDeadlineDate)}ê¹Œì§€`;

            const dinnerDeadlineDate = new Date(nextMealDate);
            dinnerDeadlineDate.setHours(15, 30, 0, 0);
            document.getElementById('deadline-dinner').textContent = `ì˜¤í›„ ${formatTime(dinnerDeadlineDate)}ê¹Œì§€`;


            const exclusionButton = document.querySelector('#reservation .btn');
            let isExclusionPossible = false;

            for (const mealType in mealDeadlines) {
                if (mealDeadlines[mealType](now, nextMealDate)) {
                    isExclusionPossible = true;
                    break;
                }
            }

            if (isExclusionPossible) {
                exclusionButton.classList.remove('btn-secondary', 'disabled');
                exclusionButton.textContent = "ìƒˆë¡œìš´ ì‹ì‚¬ ì œì™¸ ì‹ ì²­";
                exclusionButton.disabled = false;
            } else {
                exclusionButton.classList.add('btn-secondary', 'disabled');
                exclusionButton.textContent = "ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ë§ˆê°";
                exclusionButton.disabled = true;
            }
        }

        function openExclusionModalForNew() {
            const exclusionButton = document.querySelector('#reservation .btn');
            if (exclusionButton.classList.contains('disabled')) {
                alert('ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ë§ˆê° ì‹œê°„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤.');
                return;
            }

            currentModalMode = 'new';
            currentMealTypeBeingEdited = '';
            document.getElementById('modal-title').textContent = 'ìƒˆë¡œìš´ ì‹ì‚¬ ì œì™¸ ì‹ ì²­';

            const container = document.getElementById('exclusion-entries-container');
            container.innerHTML = '';
            addExclusionEntry(); // Add a single, new blank entry
            document.getElementById('exclusionModal').style.display = 'block';
        }

        function openExclusionModalForEdit(mealTypeToEdit) {
            const exclusionButton = document.querySelector('#reservation .btn');
            if (exclusionButton.classList.contains('disabled')) {
                alert('ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ë§ˆê° ì‹œê°„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤.');
                return;
            }

            currentModalMode = 'edit';
            currentMealTypeBeingEdited = mealTypeToEdit;
            document.getElementById('modal-title').textContent = `${getMealTypeName(mealTypeToEdit)} ì‹ì‚¬ ì œì™¸ ìˆ˜ì •`;


            const container = document.getElementById('exclusion-entries-container');
            container.innerHTML = '';

            const entriesForEdit = mealExclusions.filter(entry => entry.mealType === mealTypeToEdit);

            if (entriesForEdit.length > 0) {
                entriesForEdit.forEach(entry => {
                    addExclusionEntry(entry.mealType, entry.reason, entry.students);
                });
            } else {
                addExclusionEntry(mealTypeToEdit);
            }

            document.getElementById('exclusionModal').style.display = 'block';
        }

        function closeExclusionModal() {
            document.getElementById('exclusionModal').style.display = 'none';
        }

        function addExclusionEntry(mealType = '', reason = '', students = ['']) {
            const container = document.getElementById('exclusion-entries-container');
            const entryDiv = document.createElement('div');
            entryDiv.classList.add('exclusion-entry');

            const currentEntryId = `entry-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
            entryDiv.dataset.entryId = currentEntryId;

            let mealOptionsHTML = `<option value="">ì‹ì‚¬ ì„ íƒ</option>`;
            const now = new Date();

            const mealTypes = [{
                value: 'breakfast',
                label: 'ì•„ì¹¨'
            }, {
                value: 'lunch',
                label: 'ì ì‹¬'
            }, {
                value: 'dinner',
                label: 'ì €ë…'
            }];

            mealTypes.forEach(meal => {
                const isDisabled = !mealDeadlines[meal.value](now, nextMealDate);
                const isSelected = meal.value === mealType;
                mealOptionsHTML += `
                    <option value="${meal.value}" ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}>
                        ${meal.label} ${isDisabled ? '(ë§ˆê°)' : ''}
                    </option>
                `;
            });

            const studentsText = students.filter(s => s.trim() !== '').join('\n');

            entryDiv.innerHTML = `
                <button type="button" class="remove-entry-btn" onclick="removeExclusionEntry(this)">ì´ í•­ëª© ì‚­ì œ</button>
                
                <label for="meal-select-${currentEntryId}">ì œì™¸ ì‹ì‚¬:</label>
                <select id="meal-select-${currentEntryId}" required>
                    ${mealOptionsHTML}
                </select>

                <label for="students-${currentEntryId}">í•™ë²ˆ ì´ë¦„:</label>
                <textarea id="students-${currentEntryId}" placeholder="ì˜ˆ:&#10;1206 ê¹€ìƒìœ¤&#10;1207 ê¹€ì‹œìš°&#10;(í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥)" required>${studentsText}</textarea>

                <label for="reason-${currentEntryId}">ì´ìœ :</label>
                <textarea id="reason-${currentEntryId}" placeholder="ì˜ˆ: íšŒì‹, ì™¸ì¶œ, ì‹¬ìì—°, ë™ì•„ë¦¬, ê±´ê°•(ì , ì†ì´ ì•ˆ ì¢‹ìŒ ë“±), ê¸°íƒ€" required>${reason}</textarea>
            `;
            container.appendChild(entryDiv);
        }

        function removeExclusionEntry(buttonElement) {
            const entryDiv = buttonElement.closest('.exclusion-entry');
            entryDiv.remove();
        }

        function saveExclusions() {
            const container = document.getElementById('exclusion-entries-container');
            const entriesInModal = container.querySelectorAll('.exclusion-entry');
            const newOrEditedExclusions = [];
            let isValid = true;

            entriesInModal.forEach(entryElement => {
                const mealTypeSelect = entryElement.querySelector('select');
                const mealType = mealTypeSelect.value;
                const reason = entryElement.querySelector('textarea[id^="reason-"]').value.trim();
                const studentsText = entryElement.querySelector('textarea[id^="students-"]').value.trim();

                const students = studentsText.split('\n').map(s => s.trim()).filter(s => s !== '');

                if (!mealType) {
                    isValid = false;
                    alert('ëª¨ë“  ì œì™¸ í•­ëª©ì˜ ì‹ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (students.length === 0) {
                    isValid = false;
                    alert('ëª¨ë“  ì œì™¸ í•­ëª©ì— í•™ë²ˆ ì´ë¦„ì„ ìµœì†Œ í•œ ëª… ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (!reason) {
                    isValid = false;
                    alert('ëª¨ë“  ì œì™¸ í•­ëª©ì˜ ì´ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                newOrEditedExclusions.push({
                    mealType: mealType,
                    reason: reason,
                    students: students
                });
            });

            if (!isValid) {
                return;
            }

            if (currentModalMode === 'new') {
                mealExclusions = [...mealExclusions, ...newOrEditedExclusions];
            } else if (currentModalMode === 'edit') {
                mealExclusions = mealExclusions.filter(entry => entry.mealType !== currentMealTypeBeingEdited);
                mealExclusions = [...mealExclusions, ...newOrEditedExclusions];
            }

            updateExclusionSummary();
            closeExclusionModal();
            alert('ì‹ì‚¬ ì œì™¸ ì‹ ì²­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');

            if (document.getElementById('admin-dashboard-panel').style.display === 'block') {
                updateAdminDashboard();
            }
        }

        function updateExclusionSummary() {
            const summaryContainer = document.getElementById('exclusion-summary-list');
            summaryContainer.innerHTML = '';

            document.getElementById('exclusion-summary-card').style.display = 'block';

            const groupedExclusions = {
                'breakfast': [],
                'lunch': [],
                'dinner': []
            };

            mealExclusions.forEach(entry => {
                if (groupedExclusions[entry.mealType]) {
                    groupedExclusions[entry.mealType].push(entry);
                }
            });

            const mealCategories = [{
                key: 'breakfast',
                label: 'ğŸŒ… ì•„ì¹¨'
            }, {
                key: 'lunch',
                label: 'ğŸ½ï¸ ì ì‹¬'
            }, {
                key: 'dinner',
                label: 'ğŸŒ™ ì €ë…'
            }];

            mealCategories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.classList.add('exclusion-summary-category');

                const categoryHeader = document.createElement('h4');
                categoryHeader.textContent = category.label;

                const editButton = document.createElement('button');
                editButton.classList.add('edit-summary-btn');
                editButton.textContent = 'ìˆ˜ì •í•˜ê¸°';
                editButton.onclick = () => openExclusionModalForEdit(category.key);
                categoryHeader.appendChild(editButton);

                categoryDiv.appendChild(categoryHeader);

                const entriesForCategory = groupedExclusions[category.key];
                if (entriesForCategory.length > 0) {
                    entriesForCategory.forEach(entry => {
                        const summaryItem = document.createElement('div');
                        summaryItem.classList.add('exclusion-summary-item');

                        const studentNamesList = entry.students.map(s => `<li>${s}</li>`).join('');

                        summaryItem.innerHTML = `
                            <strong>ì œì™¸ í•™ìƒ: (${entry.students.length}ëª…)</strong>
                            <ul>
                                ${studentNamesList}
                            </ul>
                            <p>ì´ìœ : ${entry.reason}</p>
                        `;
                        categoryDiv.appendChild(summaryItem);
                    });
                } else {
                    const noEntryMessage = document.createElement('p');
                    noEntryMessage.classList.add('no-exclusion-message');
                    noEntryMessage.textContent = 'ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.';
                    categoryDiv.appendChild(noEntryMessage);
                }
                summaryContainer.appendChild(categoryDiv);
            });
        }

        function getMealTypeName(mealType) {
            switch (mealType) {
                case 'breakfast':
                    return 'ì•„ì¹¨';
                case 'lunch':
                    return 'ì ì‹¬';
                case 'dinner':
                    return 'ì €ë…';
                default:
                    return '';
            }
        }

        // --- Admin Panel Logic ---
        const ADMIN_PASSWORD = '090616';

        function checkAdminPassword() {
            const passwordInput = document.getElementById('admin-password');
            const passwordError = document.getElementById('password-error');
            const loginPanel = document.getElementById('admin-login-panel');
            const dashboardPanel = document.getElementById('admin-dashboard-panel');

            if (passwordInput.value === ADMIN_PASSWORD) {
                loginPanel.style.display = 'none';
                dashboardPanel.style.display = 'block';
                passwordError.style.display = 'none';
                updateAdminDashboard();
            } else {
                passwordError.style.display = 'block';
            }
        }

        function updateAdminDashboard() {
            const adminMealRatingsSummary = document.getElementById('admin-meal-ratings-summary');
            adminMealRatingsSummary.innerHTML = '';

            const mealTimes = [{
                key: 'breakfast',
                label: 'ğŸŒ… ì•„ì¹¨'
            }, {
                key: 'lunch',
                label: 'ğŸ½ï¸ ì ì‹¬'
            }, {
                key: 'dinner',
                label: 'ğŸŒ™ ì €ë…'
            }];

            mealTimes.forEach(mealTimeData => {
                const mealTimeDiv = document.createElement('div');
                mealTimeDiv.classList.add('admin-sub-section');
                const mealTimeHeader = document.createElement('h4');
                mealTimeHeader.textContent = mealTimeData.label;
                mealTimeDiv.appendChild(mealTimeHeader);

                const ul = document.createElement('ul');
                let hasRatings = false;

                for (const menuName in mealRatings[mealTimeData.key]) {
                    const ratingsMap = mealRatings[mealTimeData.key][menuName];
                    const ratingsArray = Array.from(ratingsMap.values()); // Convert Map values to array
                    const average = ratingsArray.length === 0 ? 0.0 : ratingsArray.reduce((acc, curr) => acc + curr, 0) / ratingsArray.length;
                    const count = ratingsArray.length; // Count of unique ratings

                    const li = document.createElement('li');
                    li.textContent = `${menuName}: í‰ê·  ${average.toFixed(1)}ì  (${count}ëª… í‰ê°€)`;
                    ul.appendChild(li);
                    if (count > 0) hasRatings = true;
                }

                if (!hasRatings && Object.keys(mealRatings[mealTimeData.key]).length === 0) {
                     const p = document.createElement('p');
                     p.textContent = 'ì•„ì§ ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.'; // Should not happen with static HTML
                     mealTimeDiv.appendChild(p);
                } else if (!hasRatings) {
                    const p = document.createElement('p');
                    p.textContent = 'ì•„ì§ í‰ê°€ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    mealTimeDiv.appendChild(p);
                } else {
                    mealTimeDiv.appendChild(ul);
                }
                adminMealRatingsSummary.appendChild(mealTimeDiv);
            });


            // Update Exclusion List for Admin
            const adminExclusionList = document.getElementById('admin-exclusion-list');
            adminExclusionList.innerHTML = '';

            const groupedExclusions = {
                'breakfast': [],
                'lunch': [],
                'dinner': []
            };

            mealExclusions.forEach(entry => {
                if (groupedExclusions[entry.mealType]) {
                    groupedExclusions[entry.mealType].push(entry);
                }
            });

            mealTimes.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.classList.add('admin-sub-section');

                const categoryHeader = document.createElement('h4');
                categoryHeader.textContent = `${category.label} ì œì™¸ í•™ìƒ`;
                categoryDiv.appendChild(categoryHeader);

                const entriesForCategory = groupedExclusions[category.key];
                if (entriesForCategory.length > 0) {
                    const ul = document.createElement('ul');
                    entriesForCategory.forEach(entry => {
                        entry.students.forEach(student => {
                            const li = document.createElement('li');
                            li.textContent = `${student} (ì´ìœ : ${entry.reason})`;
                            ul.appendChild(li);
                        });
                    });
                    categoryDiv.appendChild(ul);
                } else {
                    const noEntryMessage = document.createElement('p');
                    noEntryMessage.textContent = 'ì œì™¸ ì‹ ì²­ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.';
                    categoryDiv.appendChild(noEntryMessage);
                }
                adminExclusionList.appendChild(categoryDiv);
            });
        }


        function printMealEvaluations() {
            let printContent = `
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
                    h1 { text-align: center; color: #333; margin-bottom: 20px; }
                    h2 { color: #4CAF50; margin-top: 25px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
                    ul { list-style-type: none; padding-left: 0; }
                    li { margin-bottom: 8px; font-size: 14px; color: #555; }
                </style>
                <h1>ê¸‰ì‹ í‰ì  í†µê³„</h1>
            `;

            const mealTimes = [{
                key: 'breakfast',
                label: 'ì•„ì¹¨ ê¸‰ì‹'
            }, {
                key: 'lunch',
                label: 'ì ì‹¬ ê¸‰ì‹'
            }, {
                key: 'dinner',
                label: 'ì €ë… ê¸‰ì‹'
            }];

            mealTimes.forEach(mealTimeData => {
                printContent += `<h2>${mealTimeData.label}</h2><ul>`;
                let hasRatings = false;
                for (const menuName in mealRatings[mealTimeData.key]) {
                    const ratingsMap = mealRatings[mealTimeData.key][menuName];
                    const ratingsArray = Array.from(ratingsMap.values()); // Convert Map values to array
                    const average = ratingsArray.length === 0 ? 0.0 : ratingsArray.reduce((acc, curr) => acc + curr, 0) / ratingsArray.length;
                    const count = ratingsArray.length; // Count of unique ratings
                    printContent += `<li>${menuName}: í‰ê·  ${average.toFixed(1)}ì  (${count}ëª… í‰ê°€)</li>`;
                    if (count > 0) hasRatings = true;
                }
                if (!hasRatings) {
                    printContent += `<li>ì•„ì§ í‰ê°€ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>`;
                }
                printContent += `</ul>`;
            });

            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        function printExclusionList() {
            let printContent = `
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
                    h1 { text-align: center; color: #333; margin-bottom: 20px; }
                    h2 { color: #4CAF50; margin-top: 25px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
                    ul { list-style-type: disc; padding-left: 20px; }
                    li { margin-bottom: 5px; font-size: 14px; color: #555; }
                </style>
                <h1>ì‹ì‚¬ ì œì™¸ ì‹ ì²­ ëª…ë‹¨</h1>
            `;

            const mealTimes = [{
                key: 'breakfast',
                label: 'ì•„ì¹¨'
            }, {
                key: 'lunch',
                label: 'ì ì‹¬'
            }, {
                key: 'dinner',
                label: 'ì €ë…'
            }];

            mealTimes.forEach(mealTimeData => {
                printContent += `<h2>${mealTimeData.label} ì œì™¸ í•™ìƒ</h2><ul>`;
                const entriesForCategory = mealExclusions.filter(entry => entry.mealType === mealTimeData.key);
                if (entriesForCategory.length > 0) {
                    entriesForCategory.forEach(entry => {
                        entry.students.forEach(student => {
                            printContent += `<li>${student} (ì´ìœ : ${entry.reason})</li>`;
                        });
                    });
                } else {
                    printContent += `<li>ì œì™¸ ì‹ ì²­ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</li>`;
                }
                printContent += `</ul>`;
            });

            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }


        document.addEventListener('DOMContentLoaded', () => {
            initStarRatings();
            updateReservationDeadlines();
            updateExclusionSummary();

            // Populate initial voter counts on the meal menu tab
            document.querySelectorAll('.menu-item').forEach(item => {
                const mealTime = item.dataset.mealTime;
                const menuName = item.querySelector('.menu-name').dataset.menuName;
                const starsDiv = item.querySelector('.star-rating');
                const ratingValueSpan = starsDiv.querySelector('.rating-value');
                // Removed voterCountSpan for initial update as well
                updateMenuItemRatingDisplay(mealTime, menuName, starsDiv.querySelectorAll('.star'), ratingValueSpan);
            });


            setInterval(updateReservationDeadlines, 60 * 1000);
        });

        setInterval(() => {
            const statusElements = document.querySelectorAll('.meal-status');
            const statuses = ['status-available', 'status-low', 'status-soldout'];
            const statusTexts = ['ì¶©ë¶„í•¨', 'ë¶€ì¡±í•¨', 'ë§¤ì§„'];

            statusElements.forEach(element => {
                const randomIndex = Math.floor(Math.random() * 3);
                element.className = `meal-status ${statuses[randomIndex]}`;
                element.textContent = statusTexts[randomIndex];
            });
        }, 30000);
    </script>
</body>

</html>